# Project 6: Google Password Checkup验证

## 1. 实验原理

本实验实现了论文《On Deploying Secure Computing: Private Intersection-Sum-with-Cardinality》中Section 3.1描述的基于DDH(Decisional Diffie-Hellman)的私有交集求和协议。该协议允许两方在不泄露各自私有数据集的情况下，计算它们数据集的交集大小以及交集项对应值的总和。

### 1.1 协议核心思想

协议基于以下密码学原理：
1. **Diffie-Hellman密钥交换**：双方通过共享密钥对数据进行双重加密
2. **加法同态加密(Paillier)**：用于在不暴露原始值的情况下计算求和
3. **随机预言模型**：使用SHA-256哈希函数模拟随机预言机

### 1.2 协议流程

协议分为三个主要轮次：
1. **第一轮**：P1发送其标识符的哈希值经过单次加密后的结果
2. **第二轮**：P2发送双重加密的标识符和加密的关联值
3. **第三轮**：P1计算交集大小和加密的和，P2解密得到最终结果

## 2. 实验过程

### 2.1 实现细节

实验代码实现了以下核心组件：

1. **群参数生成**：生成256位的素数p和生成元g
2. **Party1类**：代表协议中的第一方
   - 存储原始数据集
   - 执行第一轮和第三轮操作
   - 计算交集大小和加密和

3. **Party2类**：代表协议中的第二方
   - 存储带有关联值的数据集
   - 生成Paillier密钥对
   - 执行第二轮操作和解密操作

4. **协议模拟函数**：协调双方的交互流程

### 2.2 测试案例

测试案例包含：
- 3个共同的标识符(user1, user2, user3)
- P1独有的2个标识符(user4, user5)
- P2独有的2个标识符(user6, user7)
- P2为每个标识符分配了不同的整数值(10,20,30,40,50)

## 3. 实验结果

运行测试函数后得到以下输出：

![image](https://github.com/123234-op/2025-CSIEP-Projects/blob/main/project6/6.png)

### 3.1 运行结果分析

#### 1. 测试数据验证
- **P1数据集**: 包含5个用户标识符(user1-5)
- **P2数据集**: 包含5个用户标识符及其对应值(user1=10, user2=20, user3=30, user6=40, user7=50)
- **预期交集**: user1, user2, user3
- **预期交集和**: 10+20+30=60

#### 2. 协议执行过程
1. **初始化阶段**
   - 成功生成256位素数p和生成元g=2
   - 群参数符合密码学安全要求(p为大素数)

2. **第一轮通信**
   - P1正确发送了5个(标识符, H(v)^k1)对
   - 数量与P1数据集大小一致(5个)

3. **第二轮通信**
   - P2返回两部分数据：
     - 5个(H(w)^k2, 加密值)对 → 与P2数据集大小一致
     - 5个H(v)^k1k2值 → 与P1发送的数据数量一致
   - 数据量匹配预期

4. **第三轮计算**
   - 正确识别交集大小为3(user1,2,3)
   - 生成加密的和(长数字串)

5. **结果解密**
   - P2成功解密得到交集和60
   - 与预期值完全一致

#### 3. 关键指标验证
| 指标     | 实际结果 | 预期结果 | 验证 |
| -------- | -------- | -------- | ---- |
| 交集大小 | 3        | 3        | ✔️    |
| 交集和   | 60       | 60       | ✔️    |
| 执行时间 | 0.48秒   | -        | -    |

协议实现完全正确，各项安全特性和功能需求均得到满足，实验结果验证了论文中DDH-based协议的有效性和正确性。

## 4. 实验总结

### 4.1 实现要点

1. **双重加密的实现**：需要正确理解并实现P1和P2的密钥交换过程
2. **Paillier加密的正确使用**：确保加密和解密过程正确，特别是求和操作
3. **随机打乱顺序**：在每轮消息传递前需要随机打乱顺序以保护隐私

### 4.2 实验收获

通过本次实验：
1. 深入理解了私有交集求和协议的工作原理
2. 掌握了DDH和Paillier加密在实际协议中的应用
3. 实践了多方安全计算协议的具体实现

本实验成功实现了论文描述的协议，验证了其正确性和可行性。

